# 串口调试助手 v1.0.0 (ImGui版本)

## 📋 项目概述

基于 **Dear ImGui + GLFW + OpenGL3** 开发的现代化串口调试助手，提供游戏级美观UI、60fps流畅渲染和完整的串口通信功能。

**开发时间**: 2025年1月6日晚（通宵完成）
**界面框架**: Dear ImGui 1.90.1
**图形库**: GLFW 3.3.8 + OpenGL 3.3
**平台**: Windows (使用Windows API实现串口通信)

---

## ✨ 主要特性

### 1. 现代化UI设计
- 🎨 **深色主题**：精心设计的深蓝灰配色方案
- 🎯 **圆角设计**：8px窗口圆角，6px控件圆角
- ⚡ **60fps渲染**：流畅的动画和交互体验
- 📐 **响应式布局**：三栏布局，窗口大小自适应
- 🖱️ **完美跟随**：所有面板随主窗口移动，无漂移

### 2. 串口通信功能
- 🔌 **自动枚举串口**：支持COM1-COM256端口扫描
- ⚙️ **完整配置选项**：
  - 波特率：1200 ~ 921600 bps（共11档）
  - 数据位：5/6/7/8 位
  - 停止位：1/1.5/2 位
  - 校验位：无校验/奇校验/偶校验
- 🔄 **异步收发**：后台线程处理数据，UI不阻塞
- 📊 **实时统计**：接收/发送字节数实时显示

### 3. 数据处理
- 🔢 **HEX/ASCII双模式**：
  - HEX显示：`48 65 6C 6C 6F`
  - ASCII显示：`Hello`
- 📝 **自动滚动**：新数据自动滚动到底部
- 🗑️ **一键清空**：快速清空接收缓冲区
- 💾 **数据日志**：自动记录到时间戳文件
- ⏰ **定时发送**：100ms-60s可配置间隔

### 4. 高级功能
- 📄 **日志记录**：
  - 自动生成文件名：`serial_log_YYYYMMDD_HHMMSS.txt`
  - 每条记录带时间戳：`[2025-01-06 23:45:12] 数据内容`
  - 实时追加写入，不丢失数据

- ⏱️ **定时发送**：
  - 可配置发送间隔（100-60000毫秒）
  - 实时显示下次发送倒计时
  - 支持HEX/ASCII两种格式定时发送

---

## 🚀 快速开始

### 编译程序

```bash
cd e:/Desktop/my_upper_computer/build_imgui
cmake . -G "MinGW Makefiles" -DCMAKE_BUILD_TYPE=Release
cmake --build . --config Release -j 4
```

### 运行程序

```bash
cd e:/Desktop/my_upper_computer/build_imgui
./bin/SerialDebugger_ImGui.exe
```

---

## 📖 使用指南

### 1. 连接串口

**步骤**：
1. 点击 **"刷新端口"** 按钮，扫描可用串口
2. 从下拉列表中选择目标串口（如 COM3）
3. 配置通信参数：
   - **波特率**：选择与设备匹配的波特率（默认115200）
   - **数据位**：通常选择8位
   - **停止位**：通常选择1位
   - **校验位**：通常选择"无校验"
4. 点击 **"连接串口"** 按钮（绿色）
5. 连接成功后，按钮变为 **"断开串口"**（红色）

**注意事项**：
- 确保目标串口未被其他程序占用
- 波特率必须与设备端一致
- 连接失败会在控制台显示错误信息

### 2. 接收数据

**操作**：
- 连接成功后，接收到的数据会自动显示在中央面板
- 勾选 **"HEX显示"** 切换显示模式
- 勾选 **"自动滚动"** 让新数据自动滚到底部
- 点击 **"清空"** 按钮清除接收缓冲区

**显示模式对比**：
```
ASCII模式：Hello World!
HEX模式：  48 65 6C 6C 6F 20 57 6F 72 6C 64 21
```

### 3. 发送数据

**ASCII发送**：
1. 在发送输入框中输入文本，如：`Hello`
2. 点击 **"发送数据"** 按钮（蓝色）
3. 查看"已发送"计数器确认发送成功

**HEX发送**：
1. 勾选 **"HEX发送"** 复选框
2. 输入HEX字符串（支持空格分隔），如：`48 65 6C 6C 6F` 或 `48656C6C6F`
3. 点击 **"发送数据"** 按钮
4. 程序会自动转换为字节数据发送

### 4. 保存日志

**启用日志**：
1. 勾选 **"保存日志"** 复选框
2. 程序自动生成日志文件（如 `serial_log_20250106_234512.txt`）
3. 所有接收的数据都会追加到日志文件
4. 每条记录带有精确的时间戳

**日志文件示例**：
```
[2025-01-06 23:45:12] 48 65 6C 6C 6F
[2025-01-06 23:45:15] 57 6F 72 6C 64
[2025-01-06 23:45:18] 21
```

### 5. 定时发送

**配置定时发送**：
1. 在发送输入框中输入要发送的数据
2. 勾选 **"启用定时发送"** 复选框
3. 配置 **"发送间隔"**（单位：毫秒）
   - 最小值：100ms（0.1秒）
   - 最大值：60000ms（60秒）
   - 默认值：1000ms（1秒）
4. 程序会显示 **"下次发送: XXX ms"** 倒计时
5. 取消勾选即可停止定时发送

**使用场景**：
- 测试设备响应：每秒发送心跳包
- 压力测试：高频发送数据包
- 自动化测试：定期发送测试命令

---

## 🏗️ 项目架构

### 文件结构

```
imgui_ui/
├── main_imgui.cpp          # 主程序：UI渲染和逻辑控制
├── SerialPort_Win.h        # 串口管理器头文件
├── SerialPort_Win.cpp      # Windows串口实现（使用Windows API）
├── DataConverter.h         # 数据转换工具头文件
├── DataConverter.cpp       # HEX/ASCII转换实现
└── README_IMGUI.md         # 本文档
```

### 核心模块

#### 1. SerialPort_Win（串口管理器）
**功能**：
- 枚举可用串口（EnumeratePorts）
- 打开/关闭串口（Open/Close）
- 同步发送数据（Write）
- 异步接收数据（后台线程 + 回调）

**关键技术**：
- Windows API：`CreateFileA`, `ReadFile`, `WriteFile`
- 重叠I/O（OVERLAPPED）实现异步操作
- 独立接收线程，避免阻塞主线程
- DCB结构配置串口参数

#### 2. DataConverter（数据转换器）
**功能**：
- `BytesToHexString`：字节数组 → HEX字符串
- `HexStringToBytes`：HEX字符串 → 字节数组
- `BytesToAsciiString`：字节数组 → ASCII字符串
- `FormatHexDump`：格式化HEX转储（带地址和ASCII对照）

**示例**：
```cpp
unsigned char data[] = {0x48, 0x65, 0x6C, 0x6C, 0x6F};
DataConverter::BytesToHexString(data, 5, true);  // "48 65 6C 6C 6F"
DataConverter::BytesToAsciiString(data, 5);      // "Hello"
```

#### 3. main_imgui.cpp（主控制）
**AppState结构**：
- 串口配置参数
- 接收/发送缓冲区
- UI状态（HEX显示、自动滚动等）
- 日志和定时发送配置

**渲染函数**：
- `RenderSerialConfigPanel`：串口配置面板
- `RenderDataDisplayPanel`：数据显示面板
- `RenderSendPanel`：发送控制面板

**主循环逻辑**：
```cpp
while (!glfwWindowShouldClose(window)) {
    glfwPollEvents();

    // 定时发送检测
    if (enable_auto_send && elapsed >= interval) {
        // 发送数据
    }

    // ImGui渲染
    ImGui::NewFrame();
    // ... 渲染UI ...
    ImGui::Render();

    // OpenGL渲染
    glClear(GL_COLOR_BUFFER_BIT);
    ImGui_ImplOpenGL3_RenderDrawData(ImGui::GetDrawData());
    glfwSwapBuffers(window);
}
```

---

## 🔧 技术细节

### 线程安全设计
- **接收回调**：在独立线程运行，通过 `std::mutex` 保护共享数据
- **主循环**：定时发送和UI渲染在主线程，避免竞态条件
- **原子操作**：`isOpen_` 和 `isReceiving_` 使用 `std::atomic<bool>`

### 内存管理
- **固定大小缓冲区**：`receive_buffer[65536]` 避免动态分配开销
- **溢出检测**：追加数据前检查可用空间，防止缓冲区溢出
- **RAII设计**：串口句柄在析构函数中自动关闭

### UI优化技巧
- **Child窗口**：使用 `ImGui::BeginChild` 创建嵌套面板
- **无边框主窗口**：`ImGuiWindowFlags_NoTitleBar | NoResize | NoMove`
- **样式定制**：自定义颜色、圆角、间距参数
- **中文字体**：加载 `msyh.ttc`（微软雅黑）支持中文显示

---

## 📊 性能指标

- **渲染帧率**：稳定60 FPS（启用垂直同步）
- **串口吞吐量**：
  - 接收：≤ 4096 字节/次（受缓冲区限制）
  - 发送：取决于波特率和硬件
- **最小定时间隔**：100ms（定时发送）
- **最大接收缓冲**：65536 字节（约64KB）

---

## 🐛 已知问题与注意事项

### 1. 中文显示
- **问题**：未加载中文字体会显示乱码
- **解决**：程序已自动加载 `c:\Windows\Fonts\msyh.ttc`
- **要求**：确保Windows系统字体目录存在微软雅黑字体

### 2. 缓冲区管理
- **限制**：接收缓冲区最大64KB，超出后新数据会被丢弃
- **建议**：定期点击"清空"按钮清理缓冲区
- **改进方向**：未来可改为循环缓冲区或自动清理

### 3. HEX模式切换
- **行为**：切换HEX/ASCII显示模式不会重新格式化已有数据
- **说明**：这是设计行为，新接收的数据会使用新模式显示
- **清空后重新接收即可应用新模式**

### 4. 定时发送精度
- **精度**：约±16ms（受系统时钟和渲染帧率影响）
- **说明**：对于高精度定时（<50ms），建议使用专用硬件
- **适用场景**：测试、心跳包等非精确时间要求应用

---

## 🔄 版本历史

### v1.0.0 (2025-01-06)
**首次发布 - 完整功能实现**

**开发阶段**：
1. ✅ **第一阶段**：修复UI布局，移除独立窗口，使用Child窗口
2. ✅ **第二阶段**：实现Windows串口管理器（SerialPort_Win）
3. ✅ **第三阶段**：实现数据转换工具（HEX/ASCII转换）
4. ✅ **第四阶段**：集成串口功能到UI（连接、发送、接收）
5. ✅ **第五阶段**：实现高级功能（日志记录、定时发送）
6. ✅ **第六阶段**：代码优化、测试和文档编写

**Git提交记录**：
- `3a2c4c5` - 第一阶段完成：修复UI布局
- `4646e84` - 第二至四阶段完成：实现完整串口通信功能
- `2c8f6cb` - 第五阶段完成：实现数据日志和定时发送功能

---

## 🎯 未来改进方向

### 短期计划（v1.1.0）
- [ ] 添加发送历史记录（下拉列表快速选择）
- [ ] 实现多串口同时监控
- [ ] 添加数据包分析工具（校验和计算）
- [ ] 支持自定义HEX显示格式（每行字节数）

### 中期计划（v1.2.0）
- [ ] 插件系统（支持自定义协议解析）
- [ ] 波形显示（实时数据可视化）
- [ ] 脚本引擎（Lua/Python自动化）
- [ ] 多语言支持（中文/英文切换）

### 长期计划（v2.0.0）
- [ ] 跨平台支持（Linux/macOS）
- [ ] 网络串口（TCP/UDP虚拟串口）
- [ ] 云同步（配置和日志云端存储）
- [ ] AI助手（智能协议识别和解析）

---

## 💡 开发心得

### 为什么选择ImGui？
1. **性能卓越**：原生C++，无虚拟机开销，60fps流畅运行
2. **即时模式**：代码简洁直观，无需复杂的MVC架构
3. **自定义性强**：样式、布局完全可控
4. **跨平台**：支持Windows/Linux/macOS，未来扩展方便

### ImGui vs Qt
| 特性 | ImGui | Qt |
|------|-------|-----|
| **性能** | ⭐⭐⭐⭐⭐ 游戏级 | ⭐⭐⭐ 一般 |
| **UI美观** | ⭐⭐⭐⭐⭐ 现代 | ⭐⭐⭐ 传统 |
| **学习曲线** | ⭐⭐⭐⭐ 简单 | ⭐⭐ 复杂 |
| **编译速度** | ⭐⭐⭐⭐⭐ 极快 | ⭐⭐ 慢 |
| **包大小** | ⭐⭐⭐⭐⭐ 小 | ⭐⭐ 大 |

### 关键技术选型
- **GLFW**：轻量级窗口管理，比GLUT更现代
- **OpenGL 3.3**：兼容性好，性能足够
- **Windows API**：直接串口控制，无需第三方库
- **MinGW**：开源编译器，无需商业许可

---

## 📞 联系与反馈

- **项目位置**：`E:\Desktop\my_upper_computer\`
- **可执行文件**：`build_imgui/bin/SerialDebugger_ImGui.exe`
- **Git仓库**：本地仓库（可推送到GitHub）

**遇到问题？**
1. 检查串口是否被其他程序占用
2. 确认波特率等参数与设备匹配
3. 查看控制台错误信息
4. 重启程序并重新连接

---

## 🎉 致谢

感谢以下开源项目：
- [Dear ImGui](https://github.com/ocornut/imgui) - 即时模式GUI框架
- [GLFW](https://www.glfw.org/) - OpenGL窗口管理
- [MinGW-w64](https://www.mingw-w64.org/) - Windows GNU工具链

---

## 📝 许可证

本项目为个人学习项目，使用 MIT 许可证。

---

**祝您使用愉快！如有任何问题或建议，欢迎反馈。** 🚀
